name: Doc
on: [push]
jobs:
  doc-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: api-generate
        run: |
          sed -i 's/\[中文\](.\/README-zh.md)/ /' README.md
          cp README.md ./docs/index.md
          cp README-zh.md ./docs/zh/index.md
          pip3 install pydoc-markdown torchei
          pip3 install typing-extensions==3.10.0.2
          echo '# API Reference' > docs/api.md
          sed -i 's/**kwargs,/**kwargs/' torchei/fault_model.py
          more torchei/fault_model.py
          pydoc-markdown -p torchei '{renderer:{type: markdown,descriptive_class_title: false,render_toc: false, header_level_by_type: { Module: 2, Class: 2, Method: 3, Function: 3} } }' > temp.md
          sed -n '1,3p;6,9999p' temp.md  >> docs/api.md
          echo '> Auto Generated by pydoc-markdown' >> docs/api.md
          ls -lR

      - name: vuepress-deploy
        uses: jenkey2011/vuepress-deploy@master
        env:
          ACCESS_TOKEN: ${{ secrets.REPO_TOKEN }}
          TARGET_BRANCH: gh-pages
          BUILD_SCRIPT: yarn && yarn docs:build
          BUILD_DIR: docs/.vuepress/dist
